"use strict";exports.__esModule=!0,exports.default=exports.Select=void 0;var _styledBase=_interopRequireDefault(require("@emotion/styled-base")),_react=_interopRequireWildcard(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_propTypes=_interopRequireDefault(require("prop-types")),_ClickOutside=_interopRequireDefault(require("./components/ClickOutside")),_Content=_interopRequireDefault(require("./components/Content")),_Dropdown=_interopRequireDefault(require("./components/Dropdown")),_Loading=_interopRequireDefault(require("./components/Loading")),_Clear=_interopRequireDefault(require("./components/Clear")),_Separator=_interopRequireDefault(require("./components/Separator")),_DropdownHandle=_interopRequireDefault(require("./components/DropdownHandle")),_util=require("./util"),_constants=require("./constants");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;return _getRequireWildcardCache=function(){return a},a}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var b=_getRequireWildcardCache();if(b&&b.has(a))return b.get(a);var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;f&&(f.get||f.set)?Object.defineProperty(c,e,f):c[e]=a[e]}return c.default=a,b&&b.set(a,c),c}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var Select=/*#__PURE__*/function(a){function b(b){var c;return c=a.call(this,b)||this,_defineProperty(_assertThisInitialized(c),"onDropdownClose",function(){c.setState({cursor:null}),c.props.onDropdownClose()}),_defineProperty(_assertThisInitialized(c),"onScroll",function(){c.props.closeOnScroll&&c.dropDown("close"),c.updateSelectBounds()}),_defineProperty(_assertThisInitialized(c),"updateSelectBounds",function(){return c.select.current&&c.setState({selectBounds:c.select.current.getBoundingClientRect()})}),_defineProperty(_assertThisInitialized(c),"getSelectBounds",function(){return c.state.selectBounds}),_defineProperty(_assertThisInitialized(c),"dropDown",function(a,b){void 0===a&&(a="toggle");var d=b&&b.target||b&&b.srcElement;return c.props.portal&&!c.props.closeOnScroll&&!c.props.closeOnSelect&&b&&d&&d.offsetParent&&d.offsetParent.classList.contains("react-dropdown-select-dropdown")?void 0:c.props.keepOpen?c.setState({dropdown:!0}):"close"===a&&c.state.dropdown?(c.select.current.blur(),c.setState({dropdown:!1,search:c.props.clearOnBlur?"":c.state.search})):"open"!==a||c.state.dropdown?"toggle"===a&&(c.select.current.focus(),c.setState({dropdown:!c.state.dropdown})):c.setState({dropdown:!0})}),_defineProperty(_assertThisInitialized(c),"getSelectRef",function(){return c.select.current}),_defineProperty(_assertThisInitialized(c),"addItem",function(a){if(c.props.multi){if((0,_util.valueExistInSelected)((0,_util.getByPath)(a,c.props.valueField),c.state.values,c.props))return c.removeItem(null,a,!1);c.setState({values:[].concat(c.state.values,[a])})}else c.setState({values:[a],dropdown:!1});return c.props.clearOnSelect&&c.setState({search:""}),!0}),_defineProperty(_assertThisInitialized(c),"removeItem",function(a,b,d){void 0===d&&(d=!1),a&&d&&(a.preventDefault(),a.stopPropagation(),c.dropDown("close")),c.setState({values:c.state.values.filter(function(a){return(0,_util.getByPath)(a,c.props.valueField)!==(0,_util.getByPath)(b,c.props.valueField)})})}),_defineProperty(_assertThisInitialized(c),"setSearch",function(a){c.setState({cursor:null}),c.setState({search:a.target.value})}),_defineProperty(_assertThisInitialized(c),"getInputSize",function(){return c.state.search?c.state.search.length:0<c.state.values.length?c.props.addPlaceholder.length:c.props.placeholder.length}),_defineProperty(_assertThisInitialized(c),"toggleSelectAll",function(){return c.setState({values:0===c.state.values.length?c.selectAll():c.clearAll()})}),_defineProperty(_assertThisInitialized(c),"clearAll",function(){c.props.onClearAll(),c.setState({values:[]})}),_defineProperty(_assertThisInitialized(c),"selectAll",function(a){void 0===a&&(a=[]),c.props.onSelectAll();var b=0<a.length?a:c.props.options.filter(function(a){return!a.disabled});c.setState({values:b})}),_defineProperty(_assertThisInitialized(c),"isSelected",function(a){return!!c.state.values.find(function(b){return(0,_util.getByPath)(b,c.props.valueField)===(0,_util.getByPath)(a,c.props.valueField)})}),_defineProperty(_assertThisInitialized(c),"areAllSelected",function(){return c.state.values.length===c.props.options.filter(function(a){return!a.disabled}).length}),_defineProperty(_assertThisInitialized(c),"safeString",function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}),_defineProperty(_assertThisInitialized(c),"sortBy",function(){var a=c.props,d=a.sortBy,e=a.options;return d?(e.sort(function(c,a){return(0,_util.getProp)(c,d)<(0,_util.getProp)(a,d)?-1:(0,_util.getProp)(c,d)>(0,_util.getProp)(a,d)?1:0}),e):e}),_defineProperty(_assertThisInitialized(c),"searchFn",function(a){var b=a.state,d=a.methods,e=new RegExp(d.safeString(b.search),"i");return d.sortBy().filter(function(a){return e.test((0,_util.getByPath)(a,c.props.searchBy)||(0,_util.getByPath)(a,c.props.valueField))})}),_defineProperty(_assertThisInitialized(c),"searchResults",function(){var a={state:c.state,props:c.props,methods:c.methods};return c.props.searchFn(a)||c.searchFn(a)}),_defineProperty(_assertThisInitialized(c),"activeCursorItem",function(a){return c.setState({activeCursorItem:a})}),_defineProperty(_assertThisInitialized(c),"handleKeyDown",function(a){var b={event:a,state:c.state,props:c.props,methods:c.methods,setState:c.setState.bind(_assertThisInitialized(c))};return c.props.handleKeyDownFn(b)||c.handleKeyDownFn(b)}),_defineProperty(_assertThisInitialized(c),"handleKeyDownFn",function(a){var b=a.event,d=a.state,e=a.props,f=a.methods,g=a.setState,h=d.cursor,i="Escape"===b.key,j="Enter"===b.key,k="ArrowUp"===b.key,l="ArrowDown"===b.key,m="Tab"===b.key&&!b.shiftKey,n=b.shiftKey&&"Tab"===b.key;if((l||m)&&null===h)return g({cursor:0});if((k||l||n||m)&&b.preventDefault(),i&&c.dropDown("close"),j){var o=f.searchResults()[h];if(o&&!o.disabled){if(e.create&&(0,_util.valueExistInSelected)(d.search,d.values,e))return null;f.addItem(o)}}return(l||m)&&f.searchResults().length===h?g({cursor:0}):void((l||m)&&g(function(a){return{cursor:a.cursor+1}}),(k||n)&&0<h&&g(function(a){return{cursor:a.cursor-1}}),(k||n)&&0===h&&g({cursor:f.searchResults().length}))}),_defineProperty(_assertThisInitialized(c),"renderDropdown",function(){return c.props.portal?_reactDom.default.createPortal(_react.default.createElement(_Dropdown.default,{props:c.props,state:c.state,methods:c.methods}),c.dropdownRoot):_react.default.createElement(_Dropdown.default,{props:c.props,state:c.state,methods:c.methods})}),_defineProperty(_assertThisInitialized(c),"createNew",function(a){var b,d=(b={},b[c.props.labelField]=a,b[c.props.valueField]=a,b);c.addItem(d),c.props.onCreateNew(d),c.setState({search:""})}),c.state={dropdown:!1,values:b.values,search:"",selectBounds:{},cursor:null},c.methods={removeItem:c.removeItem,dropDown:c.dropDown,addItem:c.addItem,setSearch:c.setSearch,getInputSize:c.getInputSize,toggleSelectAll:c.toggleSelectAll,clearAll:c.clearAll,selectAll:c.selectAll,searchResults:c.searchResults,getSelectRef:c.getSelectRef,isSelected:c.isSelected,getSelectBounds:c.getSelectBounds,areAllSelected:c.areAllSelected,handleKeyDown:c.handleKeyDown,activeCursorItem:c.activeCursorItem,createNew:c.createNew,sortBy:c.sortBy,safeString:c.safeString},c.select=_react.default.createRef(),c.dropdownRoot="undefined"!=typeof document&&document.createElement("div"),c}_inheritsLoose(b,a);var c=b.prototype;return c.componentDidMount=function componentDidMount(){this.props.portal&&this.props.portal.appendChild(this.dropdownRoot),window.addEventListener("resize",(0,_util.debounce)(this.updateSelectBounds)),window.addEventListener("scroll",(0,_util.debounce)(this.onScroll)),this.dropDown("close"),this.select&&this.updateSelectBounds()},c.componentDidUpdate=function componentDidUpdate(a,b){var c=this;!(0,_util.isEqual)(a.values,this.props.values)&&(0,_util.isEqual)(a.values,b.values)&&(this.setState({values:this.props.values},function(){c.props.onChange(c.state.values)}),this.updateSelectBounds()),b.values!==this.state.values&&(this.props.onChange(this.state.values),this.updateSelectBounds()),b.search!==this.state.search&&this.updateSelectBounds(),b.values!==this.state.values&&this.props.closeOnSelect&&this.dropDown("close"),a.multi!==this.props.multi&&this.updateSelectBounds(),b.dropdown&&b.dropdown!==this.state.dropdown&&this.onDropdownClose(),b.dropdown||b.dropdown===this.state.dropdown||this.props.onDropdownOpen()},c.componentWillUnmount=function componentWillUnmount(){this.props.portal&&this.props.portal.removeChild(this.dropdownRoot),window.removeEventListener("resize",(0,_util.debounce)(this.updateSelectBounds,this.props.debounceDelay)),window.removeEventListener("scroll",(0,_util.debounce)(this.onScroll,this.props.debounceDelay))},c.render=function render(){var a=this;return _react.default.createElement(_ClickOutside.default,{onClickOutside:function onClickOutside(b){return a.dropDown("close",b)}},_react.default.createElement(ReactDropdownSelect,_extends({onKeyDown:this.handleKeyDown,onClick:function onClick(b){return a.dropDown("open",b)},onFocus:function onFocus(b){return a.dropDown("open",b)},tabIndex:"0",direction:this.props.direction,style:this.props.style,ref:this.select,disabled:this.props.disabled,className:_constants.LIB_NAME+" "+this.props.className,color:this.props.color},this.props.additionalProps),_react.default.createElement(_Content.default,{props:this.props,state:this.state,methods:this.methods}),(this.props.name||this.props.required)&&_react.default.createElement("input",{style:{opacity:0,width:0,position:"absolute"},name:this.props.name,required:this.props.required,pattern:this.props.pattern,value:this.state.values.map(function(b){return b[a.props.labelField]}).toString()||[]}),this.props.loading&&_react.default.createElement(_Loading.default,{props:this.props}),this.props.clearable&&_react.default.createElement(_Clear.default,{props:this.props,state:this.state,methods:this.methods}),this.props.separator&&_react.default.createElement(_Separator.default,{props:this.props,state:this.state,methods:this.methods}),this.props.dropdownHandle&&_react.default.createElement(_DropdownHandle.default,{onClick:function onClick(){return a.select.current.focus()},props:this.props,state:this.state,methods:this.methods}),this.state.dropdown&&this.renderDropdown()))},b}(_react.Component);exports.Select=Select,Select.defaultProps={addPlaceholder:"",placeholder:"Select...",values:[],options:[],multi:!1,disabled:!1,searchBy:"label",sortBy:null,clearable:!1,searchable:!0,dropdownHandle:!0,separator:!1,keepOpen:void 0,noDataLabel:"No data",createNewLabel:"add {search}",disabledLabel:"disabled",dropdownGap:5,closeOnScroll:!1,debounceDelay:0,labelField:"label",valueField:"value",color:"#0074D9",keepSelectedInList:!0,closeOnSelect:!1,clearOnBlur:!0,clearOnSelect:!0,dropdownPosition:"bottom",dropdownHeight:"300px",autoFocus:!1,portal:null,create:!1,direction:"ltr",name:null,required:!1,pattern:!1,onChange:function onChange(){},onDropdownOpen:function onDropdownOpen(){},onDropdownClose:function onDropdownClose(){},onClearAll:function onClearAll(){},onSelectAll:function onSelectAll(){},onCreateNew:function onCreateNew(){},searchFn:function searchFn(){},handleKeyDownFn:function handleKeyDownFn(){},additionalProps:null};var ReactDropdownSelect=(0,_styledBase.default)("div",{target:"e1gzf2xs0",label:"ReactDropdownSelect"})("position:relative;display:flex;border:1px solid #ccc;width:100%;border-radius:2px;padding:2px 5px;flex-direction:row;direction:",function(a){var b=a.direction;return b},";align-items:center;cursor:pointer;min-height:36px;",function(a){var b=a.disabled;return b?"cursor: not-allowed;pointer-events: none;opacity: 0.3;":"pointer-events: all;"},":hover,:focus-within{border-color:",function(a){var b=a.color;return b},";}:focus,:focus-within{outline:0;box-shadow:0 0 0 3px ",function(a){var b=a.color;return(0,_util.hexToRGBA)(b,.2)},";}"+("production"===process.env.NODE_ENV?"":"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUEraEJzQyIsImZpbGUiOiIuLi9zcmMvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdAZW1vdGlvbi9zdHlsZWQnO1xuaW1wb3J0IENsaWNrT3V0c2lkZSBmcm9tICcuL2NvbXBvbmVudHMvQ2xpY2tPdXRzaWRlJztcblxuaW1wb3J0IENvbnRlbnQgZnJvbSAnLi9jb21wb25lbnRzL0NvbnRlbnQnO1xuaW1wb3J0IERyb3Bkb3duIGZyb20gJy4vY29tcG9uZW50cy9Ecm9wZG93bic7XG5pbXBvcnQgTG9hZGluZyBmcm9tICcuL2NvbXBvbmVudHMvTG9hZGluZyc7XG5pbXBvcnQgQ2xlYXIgZnJvbSAnLi9jb21wb25lbnRzL0NsZWFyJztcbmltcG9ydCBTZXBhcmF0b3IgZnJvbSAnLi9jb21wb25lbnRzL1NlcGFyYXRvcic7XG5pbXBvcnQgRHJvcGRvd25IYW5kbGUgZnJvbSAnLi9jb21wb25lbnRzL0Ryb3Bkb3duSGFuZGxlJztcblxuaW1wb3J0IHsgZGVib3VuY2UsIGhleFRvUkdCQSwgaXNFcXVhbCwgZ2V0QnlQYXRoLCBnZXRQcm9wLCB2YWx1ZUV4aXN0SW5TZWxlY3RlZCB9IGZyb20gJy4vdXRpbCc7XG5pbXBvcnQgeyBMSUJfTkFNRSB9IGZyb20gJy4vY29uc3RhbnRzJztcblxuZXhwb3J0IGNsYXNzIFNlbGVjdCBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25Ecm9wZG93bkNsb3NlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkRyb3Bkb3duT3BlbjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25DbGVhckFsbDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25TZWxlY3RBbGw6IFByb3BUeXBlcy5mdW5jLFxuICAgIHZhbHVlczogUHJvcFR5cGVzLmFycmF5LFxuICAgIG9wdGlvbnM6IFByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkLFxuICAgIGtlZXBPcGVuOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBkcm9wZG93bkdhcDogUHJvcFR5cGVzLm51bWJlcixcbiAgICBtdWx0aTogUHJvcFR5cGVzLmJvb2wsXG4gICAgcGxhY2Vob2xkZXI6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgYWRkUGxhY2Vob2xkZXI6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBsb2FkaW5nOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBjbGVhcmFibGU6IFByb3BUeXBlcy5ib29sLFxuICAgIHNlYXJjaGFibGU6IFByb3BUeXBlcy5ib29sLFxuICAgIHNlcGFyYXRvcjogUHJvcFR5cGVzLmJvb2wsXG4gICAgZHJvcGRvd25IYW5kbGU6IFByb3BUeXBlcy5ib29sLFxuICAgIHNlYXJjaEJ5OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHNvcnRCeTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjbG9zZU9uU2Nyb2xsOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBvcGVuT25Ub3A6IFByb3BUeXBlcy5ib29sLFxuICAgIHN0eWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGNvbnRlbnRSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgZHJvcGRvd25SZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgaXRlbVJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBub0RhdGFSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb3B0aW9uUmVuZGVyZXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIGlucHV0UmVuZGVyZXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIGxvYWRpbmdSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgY2xlYXJSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgc2VwYXJhdG9yUmVuZGVyZXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIGRyb3Bkb3duSGFuZGxlUmVuZGVyZXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIGRpcmVjdGlvbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgICByZXF1aXJlZDogUHJvcFR5cGVzLmJvb2wsXG4gICAgcGF0dGVybjogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBuYW1lOiBQcm9wVHlwZXMuc3RyaW5nXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgZHJvcGRvd246IGZhbHNlLFxuICAgICAgdmFsdWVzOiBwcm9wcy52YWx1ZXMsXG4gICAgICBzZWFyY2g6ICcnLFxuICAgICAgc2VsZWN0Qm91bmRzOiB7fSxcbiAgICAgIGN1cnNvcjogbnVsbFxuICAgIH07XG5cbiAgICB0aGlzLm1ldGhvZHMgPSB7XG4gICAgICByZW1vdmVJdGVtOiB0aGlzLnJlbW92ZUl0ZW0sXG4gICAgICBkcm9wRG93bjogdGhpcy5kcm9wRG93bixcbiAgICAgIGFkZEl0ZW06IHRoaXMuYWRkSXRlbSxcbiAgICAgIHNldFNlYXJjaDogdGhpcy5zZXRTZWFyY2gsXG4gICAgICBnZXRJbnB1dFNpemU6IHRoaXMuZ2V0SW5wdXRTaXplLFxuICAgICAgdG9nZ2xlU2VsZWN0QWxsOiB0aGlzLnRvZ2dsZVNlbGVjdEFsbCxcbiAgICAgIGNsZWFyQWxsOiB0aGlzLmNsZWFyQWxsLFxuICAgICAgc2VsZWN0QWxsOiB0aGlzLnNlbGVjdEFsbCxcbiAgICAgIHNlYXJjaFJlc3VsdHM6IHRoaXMuc2VhcmNoUmVzdWx0cyxcbiAgICAgIGdldFNlbGVjdFJlZjogdGhpcy5nZXRTZWxlY3RSZWYsXG4gICAgICBpc1NlbGVjdGVkOiB0aGlzLmlzU2VsZWN0ZWQsXG4gICAgICBnZXRTZWxlY3RCb3VuZHM6IHRoaXMuZ2V0U2VsZWN0Qm91bmRzLFxuICAgICAgYXJlQWxsU2VsZWN0ZWQ6IHRoaXMuYXJlQWxsU2VsZWN0ZWQsXG4gICAgICBoYW5kbGVLZXlEb3duOiB0aGlzLmhhbmRsZUtleURvd24sXG4gICAgICBhY3RpdmVDdXJzb3JJdGVtOiB0aGlzLmFjdGl2ZUN1cnNvckl0ZW0sXG4gICAgICBjcmVhdGVOZXc6IHRoaXMuY3JlYXRlTmV3LFxuICAgICAgc29ydEJ5OiB0aGlzLnNvcnRCeSxcbiAgICAgIHNhZmVTdHJpbmc6IHRoaXMuc2FmZVN0cmluZ1xuICAgIH07XG5cbiAgICB0aGlzLnNlbGVjdCA9IFJlYWN0LmNyZWF0ZVJlZigpO1xuICAgIHRoaXMuZHJvcGRvd25Sb290ID0gdHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMucHJvcHMucG9ydGFsICYmIHRoaXMucHJvcHMucG9ydGFsLmFwcGVuZENoaWxkKHRoaXMuZHJvcGRvd25Sb290KTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGVib3VuY2UodGhpcy51cGRhdGVTZWxlY3RCb3VuZHMpKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgZGVib3VuY2UodGhpcy5vblNjcm9sbCkpO1xuXG4gICAgdGhpcy5kcm9wRG93bignY2xvc2UnKTtcblxuICAgIGlmICh0aGlzLnNlbGVjdCkge1xuICAgICAgdGhpcy51cGRhdGVTZWxlY3RCb3VuZHMoKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzLCBwcmV2U3RhdGUpIHtcbiAgICBpZiAoXG4gICAgICAhaXNFcXVhbChwcmV2UHJvcHMudmFsdWVzLCB0aGlzLnByb3BzLnZhbHVlcykgJiZcbiAgICAgIGlzRXF1YWwocHJldlByb3BzLnZhbHVlcywgcHJldlN0YXRlLnZhbHVlcylcbiAgICApIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICB2YWx1ZXM6IHRoaXMucHJvcHMudmFsdWVzXG4gICAgICB9LCAoKSA9PiB7XG4gICAgICAgIHRoaXMucHJvcHMub25DaGFuZ2UodGhpcy5zdGF0ZS52YWx1ZXMpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdEJvdW5kcygpO1xuICAgIH1cblxuICAgIGlmIChwcmV2U3RhdGUudmFsdWVzICE9PSB0aGlzLnN0YXRlLnZhbHVlcykge1xuICAgICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh0aGlzLnN0YXRlLnZhbHVlcyk7XG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdEJvdW5kcygpO1xuICAgIH1cblxuICAgIGlmIChwcmV2U3RhdGUuc2VhcmNoICE9PSB0aGlzLnN0YXRlLnNlYXJjaCkge1xuICAgICAgdGhpcy51cGRhdGVTZWxlY3RCb3VuZHMoKTtcbiAgICB9XG5cbiAgICBpZiAocHJldlN0YXRlLnZhbHVlcyAhPT0gdGhpcy5zdGF0ZS52YWx1ZXMgJiYgdGhpcy5wcm9wcy5jbG9zZU9uU2VsZWN0KSB7XG4gICAgICB0aGlzLmRyb3BEb3duKCdjbG9zZScpO1xuICAgIH1cblxuICAgIGlmIChwcmV2UHJvcHMubXVsdGkgIT09IHRoaXMucHJvcHMubXVsdGkpIHtcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzKCk7XG4gICAgfVxuXG4gICAgaWYgKHByZXZTdGF0ZS5kcm9wZG93biAmJiBwcmV2U3RhdGUuZHJvcGRvd24gIT09IHRoaXMuc3RhdGUuZHJvcGRvd24pIHtcbiAgICAgIHRoaXMub25Ecm9wZG93bkNsb3NlKCk7XG4gICAgfVxuXG4gICAgaWYgKCFwcmV2U3RhdGUuZHJvcGRvd24gJiYgcHJldlN0YXRlLmRyb3Bkb3duICE9PSB0aGlzLnN0YXRlLmRyb3Bkb3duKSB7XG4gICAgICB0aGlzLnByb3BzLm9uRHJvcGRvd25PcGVuKCk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5wcm9wcy5wb3J0YWwgJiYgdGhpcy5wcm9wcy5wb3J0YWwucmVtb3ZlQ2hpbGQodGhpcy5kcm9wZG93blJvb3QpO1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgJ3Jlc2l6ZScsXG4gICAgICBkZWJvdW5jZSh0aGlzLnVwZGF0ZVNlbGVjdEJvdW5kcywgdGhpcy5wcm9wcy5kZWJvdW5jZURlbGF5KVxuICAgICk7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGRlYm91bmNlKHRoaXMub25TY3JvbGwsIHRoaXMucHJvcHMuZGVib3VuY2VEZWxheSkpO1xuICB9XG5cbiAgb25Ecm9wZG93bkNsb3NlID0gKCkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBjdXJzb3I6IG51bGwgfSk7XG4gICAgdGhpcy5wcm9wcy5vbkRyb3Bkb3duQ2xvc2UoKTtcbiAgfTtcblxuICBvblNjcm9sbCA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5wcm9wcy5jbG9zZU9uU2Nyb2xsKSB7XG4gICAgICB0aGlzLmRyb3BEb3duKCdjbG9zZScpO1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzKCk7XG4gIH07XG5cbiAgdXBkYXRlU2VsZWN0Qm91bmRzID0gKCkgPT5cbiAgICB0aGlzLnNlbGVjdC5jdXJyZW50ICYmXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBzZWxlY3RCb3VuZHM6IHRoaXMuc2VsZWN0LmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICB9KTtcblxuICBnZXRTZWxlY3RCb3VuZHMgPSAoKSA9PiB0aGlzLnN0YXRlLnNlbGVjdEJvdW5kcztcblxuICBkcm9wRG93biA9IChhY3Rpb24gPSAndG9nZ2xlJywgZXZlbnQpID0+IHtcbiAgICBjb25zdCB0YXJnZXQgPSAoZXZlbnQgJiYgZXZlbnQudGFyZ2V0KSB8fCAoZXZlbnQgJiYgZXZlbnQuc3JjRWxlbWVudCk7XG5cbiAgICBpZiAoXG4gICAgICB0aGlzLnByb3BzLnBvcnRhbCAmJlxuICAgICAgIXRoaXMucHJvcHMuY2xvc2VPblNjcm9sbCAmJlxuICAgICAgIXRoaXMucHJvcHMuY2xvc2VPblNlbGVjdCAmJlxuICAgICAgZXZlbnQgJiZcbiAgICAgIHRhcmdldCAmJlxuICAgICAgdGFyZ2V0Lm9mZnNldFBhcmVudCAmJlxuICAgICAgdGFyZ2V0Lm9mZnNldFBhcmVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3JlYWN0LWRyb3Bkb3duLXNlbGVjdC1kcm9wZG93bicpXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucHJvcHMua2VlcE9wZW4pIHtcbiAgICAgIHJldHVybiB0aGlzLnNldFN0YXRlKHsgZHJvcGRvd246IHRydWUgfSk7XG4gICAgfVxuXG4gICAgaWYgKGFjdGlvbiA9PT0gJ2Nsb3NlJyAmJiB0aGlzLnN0YXRlLmRyb3Bkb3duKSB7XG4gICAgICB0aGlzLnNlbGVjdC5jdXJyZW50LmJsdXIoKTtcblxuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBkcm9wZG93bjogZmFsc2UsXG4gICAgICAgIHNlYXJjaDogdGhpcy5wcm9wcy5jbGVhck9uQmx1ciA/ICcnIDogdGhpcy5zdGF0ZS5zZWFyY2hcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChhY3Rpb24gPT09ICdvcGVuJyAmJiAhdGhpcy5zdGF0ZS5kcm9wZG93bikge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoeyBkcm9wZG93bjogdHJ1ZSB9KTtcbiAgICB9XG5cbiAgICBpZiAoYWN0aW9uID09PSAndG9nZ2xlJykge1xuICAgICAgdGhpcy5zZWxlY3QuY3VycmVudC5mb2N1cygpO1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoeyBkcm9wZG93bjogIXRoaXMuc3RhdGUuZHJvcGRvd24gfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGdldFNlbGVjdFJlZiA9ICgpID0+IHRoaXMuc2VsZWN0LmN1cnJlbnQ7XG5cbiAgYWRkSXRlbSA9IChpdGVtKSA9PiB7XG4gICAgaWYgKHRoaXMucHJvcHMubXVsdGkpIHtcbiAgICAgIGlmIChcbiAgICAgICAgdmFsdWVFeGlzdEluU2VsZWN0ZWQoZ2V0QnlQYXRoKGl0ZW0sIHRoaXMucHJvcHMudmFsdWVGaWVsZCksIHRoaXMuc3RhdGUudmFsdWVzLCB0aGlzLnByb3BzKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW92ZUl0ZW0obnVsbCwgaXRlbSwgZmFsc2UpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgdmFsdWVzOiBbLi4udGhpcy5zdGF0ZS52YWx1ZXMsIGl0ZW1dXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHZhbHVlczogW2l0ZW1dLFxuICAgICAgICBkcm9wZG93bjogZmFsc2VcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMucHJvcHMuY2xlYXJPblNlbGVjdCAmJiB0aGlzLnNldFN0YXRlKHsgc2VhcmNoOiAnJyB9KTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIHJlbW92ZUl0ZW0gPSAoZXZlbnQsIGl0ZW0sIGNsb3NlID0gZmFsc2UpID0+IHtcbiAgICBpZiAoZXZlbnQgJiYgY2xvc2UpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHRoaXMuZHJvcERvd24oJ2Nsb3NlJyk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICB2YWx1ZXM6IHRoaXMuc3RhdGUudmFsdWVzLmZpbHRlcihcbiAgICAgICAgKHZhbHVlcykgPT5cbiAgICAgICAgICBnZXRCeVBhdGgodmFsdWVzLCB0aGlzLnByb3BzLnZhbHVlRmllbGQpICE9PSBnZXRCeVBhdGgoaXRlbSwgdGhpcy5wcm9wcy52YWx1ZUZpZWxkKVxuICAgICAgKVxuICAgIH0pO1xuICB9O1xuXG4gIHNldFNlYXJjaCA9IChldmVudCkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgY3Vyc29yOiBudWxsXG4gICAgfSk7XG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHNlYXJjaDogZXZlbnQudGFyZ2V0LnZhbHVlXG4gICAgfSk7XG4gIH07XG5cbiAgZ2V0SW5wdXRTaXplID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLnN0YXRlLnNlYXJjaCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuc2VhcmNoLmxlbmd0aDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcHMuYWRkUGxhY2Vob2xkZXIubGVuZ3RoO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnByb3BzLnBsYWNlaG9sZGVyLmxlbmd0aDtcbiAgfTtcblxuICB0b2dnbGVTZWxlY3RBbGwgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgdmFsdWVzOiB0aGlzLnN0YXRlLnZhbHVlcy5sZW5ndGggPT09IDAgPyB0aGlzLnNlbGVjdEFsbCgpIDogdGhpcy5jbGVhckFsbCgpXG4gICAgfSk7XG4gIH07XG5cbiAgY2xlYXJBbGwgPSAoKSA9PiB7XG4gICAgdGhpcy5wcm9wcy5vbkNsZWFyQWxsKCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICB2YWx1ZXM6IFtdXG4gICAgfSk7XG4gIH07XG5cbiAgc2VsZWN0QWxsID0gKHZhbHVlc0xpc3Q9W10pID0+IHtcbiAgICB0aGlzLnByb3BzLm9uU2VsZWN0QWxsKCk7XG4gICAgY29uc3QgdmFsdWVzID0gdmFsdWVzTGlzdC5sZW5ndGggPiAwXG4gICAgICA/IHZhbHVlc0xpc3RcbiAgICAgIDogdGhpcy5wcm9wcy5vcHRpb25zLmZpbHRlcigob3B0aW9uKSA9PiAhb3B0aW9uLmRpc2FibGVkKTtcblxuICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZXMgfSk7XG4gIH07XG5cbiAgaXNTZWxlY3RlZCA9IChvcHRpb24pID0+XG4gICAgISF0aGlzLnN0YXRlLnZhbHVlcy5maW5kKFxuICAgICAgKHZhbHVlKSA9PlxuICAgICAgICBnZXRCeVBhdGgodmFsdWUsIHRoaXMucHJvcHMudmFsdWVGaWVsZCkgPT09IGdldEJ5UGF0aChvcHRpb24sIHRoaXMucHJvcHMudmFsdWVGaWVsZClcbiAgICApO1xuXG4gIGFyZUFsbFNlbGVjdGVkID0gKCkgPT5cbiAgICB0aGlzLnN0YXRlLnZhbHVlcy5sZW5ndGggPT09IHRoaXMucHJvcHMub3B0aW9ucy5maWx0ZXIoKG9wdGlvbikgPT4gIW9wdGlvbi5kaXNhYmxlZCkubGVuZ3RoO1xuXG4gIHNhZmVTdHJpbmcgPSAoc3RyaW5nKSA9PiBzdHJpbmcucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csICdcXFxcJCYnKTtcblxuICBzb3J0QnkgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBzb3J0QnksIG9wdGlvbnMgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoIXNvcnRCeSkge1xuICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgfVxuXG4gICAgb3B0aW9ucy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBpZiAoZ2V0UHJvcChhLCBzb3J0QnkpIDwgZ2V0UHJvcChiLCBzb3J0QnkpKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH0gZWxzZSBpZiAoZ2V0UHJvcChhLCBzb3J0QnkpID4gZ2V0UHJvcChiLCBzb3J0QnkpKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gb3B0aW9ucztcbiAgfTtcblxuICBzZWFyY2hGbiA9ICh7IHN0YXRlLCBtZXRob2RzIH0pID0+IHtcbiAgICBjb25zdCByZWdleHAgPSBuZXcgUmVnRXhwKG1ldGhvZHMuc2FmZVN0cmluZyhzdGF0ZS5zZWFyY2gpLCAnaScpO1xuXG4gICAgcmV0dXJuIG1ldGhvZHNcbiAgICAgIC5zb3J0QnkoKVxuICAgICAgLmZpbHRlcigoaXRlbSkgPT5cbiAgICAgICAgcmVnZXhwLnRlc3QoZ2V0QnlQYXRoKGl0ZW0sIHRoaXMucHJvcHMuc2VhcmNoQnkpIHx8IGdldEJ5UGF0aChpdGVtLCB0aGlzLnByb3BzLnZhbHVlRmllbGQpKVxuICAgICAgKTtcbiAgfTtcblxuICBzZWFyY2hSZXN1bHRzID0gKCkgPT4ge1xuICAgIGNvbnN0IGFyZ3MgPSB7IHN0YXRlOiB0aGlzLnN0YXRlLCBwcm9wczogdGhpcy5wcm9wcywgbWV0aG9kczogdGhpcy5tZXRob2RzIH07XG5cbiAgICByZXR1cm4gdGhpcy5wcm9wcy5zZWFyY2hGbihhcmdzKSB8fCB0aGlzLnNlYXJjaEZuKGFyZ3MpO1xuICB9O1xuXG4gIGFjdGl2ZUN1cnNvckl0ZW0gPSAoYWN0aXZlQ3Vyc29ySXRlbSkgPT5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGFjdGl2ZUN1cnNvckl0ZW1cbiAgICB9KTtcblxuICBoYW5kbGVLZXlEb3duID0gKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgYXJncyA9IHtcbiAgICAgIGV2ZW50LFxuICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICBwcm9wczogdGhpcy5wcm9wcyxcbiAgICAgIG1ldGhvZHM6IHRoaXMubWV0aG9kcyxcbiAgICAgIHNldFN0YXRlOiB0aGlzLnNldFN0YXRlLmJpbmQodGhpcylcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMucHJvcHMuaGFuZGxlS2V5RG93bkZuKGFyZ3MpIHx8IHRoaXMuaGFuZGxlS2V5RG93bkZuKGFyZ3MpO1xuICB9O1xuXG4gIGhhbmRsZUtleURvd25GbiA9ICh7IGV2ZW50LCBzdGF0ZSwgcHJvcHMsIG1ldGhvZHMsIHNldFN0YXRlIH0pID0+IHtcbiAgICBjb25zdCB7IGN1cnNvciB9ID0gc3RhdGU7XG4gICAgY29uc3QgZXNjYXBlID0gZXZlbnQua2V5ID09PSAnRXNjYXBlJztcbiAgICBjb25zdCBlbnRlciA9IGV2ZW50LmtleSA9PT0gJ0VudGVyJztcbiAgICBjb25zdCBhcnJvd1VwID0gZXZlbnQua2V5ID09PSAnQXJyb3dVcCc7XG4gICAgY29uc3QgYXJyb3dEb3duID0gZXZlbnQua2V5ID09PSAnQXJyb3dEb3duJztcbiAgICBjb25zdCB0YWIgPSBldmVudC5rZXkgPT09ICdUYWInICYmICFldmVudC5zaGlmdEtleTtcbiAgICBjb25zdCBzaGlmdFRhYiA9IGV2ZW50LnNoaWZ0S2V5ICYmIGV2ZW50LmtleSA9PT0gJ1RhYic7XG5cbiAgICBpZiAoKGFycm93RG93biB8fCB0YWIpICYmIGN1cnNvciA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHNldFN0YXRlKHtcbiAgICAgICAgY3Vyc29yOiAwXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoYXJyb3dVcCB8fCBhcnJvd0Rvd24gfHwgc2hpZnRUYWIgfHwgdGFiKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgIGlmIChlc2NhcGUpIHtcbiAgICAgIHRoaXMuZHJvcERvd24oJ2Nsb3NlJyk7XG4gICAgfVxuXG4gICAgaWYgKGVudGVyKSB7XG4gICAgICBjb25zdCBjdXJyZW50SXRlbSA9IG1ldGhvZHMuc2VhcmNoUmVzdWx0cygpW2N1cnNvcl07XG4gICAgICBpZiAoY3VycmVudEl0ZW0gJiYgIWN1cnJlbnRJdGVtLmRpc2FibGVkKSB7XG4gICAgICAgIGlmIChwcm9wcy5jcmVhdGUgJiYgdmFsdWVFeGlzdEluU2VsZWN0ZWQoc3RhdGUuc2VhcmNoLCBzdGF0ZS52YWx1ZXMsIHByb3BzKSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgbWV0aG9kcy5hZGRJdGVtKGN1cnJlbnRJdGVtKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoKGFycm93RG93biB8fCB0YWIpICYmIG1ldGhvZHMuc2VhcmNoUmVzdWx0cygpLmxlbmd0aCA9PT0gY3Vyc29yKSB7XG4gICAgICByZXR1cm4gc2V0U3RhdGUoe1xuICAgICAgICBjdXJzb3I6IDBcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChhcnJvd0Rvd24gfHwgdGFiKSB7XG4gICAgICBzZXRTdGF0ZSgocHJldlN0YXRlKSA9PiAoe1xuICAgICAgICBjdXJzb3I6IHByZXZTdGF0ZS5jdXJzb3IgKyAxXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgaWYgKChhcnJvd1VwIHx8IHNoaWZ0VGFiKSAmJiBjdXJzb3IgPiAwKSB7XG4gICAgICBzZXRTdGF0ZSgocHJldlN0YXRlKSA9PiAoe1xuICAgICAgICBjdXJzb3I6IHByZXZTdGF0ZS5jdXJzb3IgLSAxXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgaWYgKChhcnJvd1VwIHx8IHNoaWZ0VGFiKSAmJiBjdXJzb3IgPT09IDApIHtcbiAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgY3Vyc29yOiBtZXRob2RzLnNlYXJjaFJlc3VsdHMoKS5sZW5ndGhcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICByZW5kZXJEcm9wZG93biA9ICgpID0+XG4gICAgdGhpcy5wcm9wcy5wb3J0YWwgPyAoXG4gICAgICBSZWFjdERPTS5jcmVhdGVQb3J0YWwoXG4gICAgICAgIDxEcm9wZG93biBwcm9wcz17dGhpcy5wcm9wc30gc3RhdGU9e3RoaXMuc3RhdGV9IG1ldGhvZHM9e3RoaXMubWV0aG9kc30gLz4sXG4gICAgICAgIHRoaXMuZHJvcGRvd25Sb290XG4gICAgICApXG4gICAgKSA6IChcbiAgICAgIDxEcm9wZG93biBwcm9wcz17dGhpcy5wcm9wc30gc3RhdGU9e3RoaXMuc3RhdGV9IG1ldGhvZHM9e3RoaXMubWV0aG9kc30gLz5cbiAgICApO1xuXG4gIGNyZWF0ZU5ldyA9IChpdGVtKSA9PiB7XG4gICAgY29uc3QgbmV3VmFsdWUgPSB7XG4gICAgICBbdGhpcy5wcm9wcy5sYWJlbEZpZWxkXTogaXRlbSxcbiAgICAgIFt0aGlzLnByb3BzLnZhbHVlRmllbGRdOiBpdGVtXG4gICAgfTtcblxuICAgIHRoaXMuYWRkSXRlbShuZXdWYWx1ZSk7XG4gICAgdGhpcy5wcm9wcy5vbkNyZWF0ZU5ldyhuZXdWYWx1ZSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHNlYXJjaDogJycgfSk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8Q2xpY2tPdXRzaWRlIG9uQ2xpY2tPdXRzaWRlPXsoZXZlbnQpID0+IHRoaXMuZHJvcERvd24oJ2Nsb3NlJywgZXZlbnQpfT5cbiAgICAgICAgPFJlYWN0RHJvcGRvd25TZWxlY3RcbiAgICAgICAgICBvbktleURvd249e3RoaXMuaGFuZGxlS2V5RG93bn1cbiAgICAgICAgICBvbkNsaWNrPXsoZXZlbnQpID0+IHRoaXMuZHJvcERvd24oJ29wZW4nLCBldmVudCl9XG4gICAgICAgICAgb25Gb2N1cz17KGV2ZW50KSA9PiB0aGlzLmRyb3BEb3duKCdvcGVuJywgZXZlbnQpfVxuICAgICAgICAgIHRhYkluZGV4PVwiMFwiXG4gICAgICAgICAgZGlyZWN0aW9uPXt0aGlzLnByb3BzLmRpcmVjdGlvbn1cbiAgICAgICAgICBzdHlsZT17dGhpcy5wcm9wcy5zdHlsZX1cbiAgICAgICAgICByZWY9e3RoaXMuc2VsZWN0fVxuICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnByb3BzLmRpc2FibGVkfVxuICAgICAgICAgIGNsYXNzTmFtZT17YCR7TElCX05BTUV9ICR7dGhpcy5wcm9wcy5jbGFzc05hbWV9YH1cbiAgICAgICAgICBjb2xvcj17dGhpcy5wcm9wcy5jb2xvcn1cbiAgICAgICAgICB7Li4udGhpcy5wcm9wcy5hZGRpdGlvbmFsUHJvcHN9PlxuICAgICAgICAgIDxDb250ZW50IHByb3BzPXt0aGlzLnByb3BzfSBzdGF0ZT17dGhpcy5zdGF0ZX0gbWV0aG9kcz17dGhpcy5tZXRob2RzfSAvPlxuXG4gICAgICAgICAgeyh0aGlzLnByb3BzLm5hbWUgfHwgdGhpcy5wcm9wcy5yZXF1aXJlZCkgJiYgKFxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgIHN0eWxlPXt7IG9wYWNpdHk6IDAsIHdpZHRoOiAwLCBwb3NpdGlvbjogJ2Fic29sdXRlJyB9fVxuICAgICAgICAgICAgICBuYW1lPXt0aGlzLnByb3BzLm5hbWV9XG4gICAgICAgICAgICAgIHJlcXVpcmVkPXt0aGlzLnByb3BzLnJlcXVpcmVkfVxuICAgICAgICAgICAgICBwYXR0ZXJuPXt0aGlzLnByb3BzLnBhdHRlcm59XG4gICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLnZhbHVlcy5tYXAodmFsdWUgPT4gdmFsdWVbdGhpcy5wcm9wcy5sYWJlbEZpZWxkXSkudG9TdHJpbmcoKSB8fCBbXX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cblxuICAgICAgICAgIHt0aGlzLnByb3BzLmxvYWRpbmcgJiYgPExvYWRpbmcgcHJvcHM9e3RoaXMucHJvcHN9IC8+fVxuXG4gICAgICAgICAge3RoaXMucHJvcHMuY2xlYXJhYmxlICYmIChcbiAgICAgICAgICAgIDxDbGVhciBwcm9wcz17dGhpcy5wcm9wc30gc3RhdGU9e3RoaXMuc3RhdGV9IG1ldGhvZHM9e3RoaXMubWV0aG9kc30gLz5cbiAgICAgICAgICApfVxuXG4gICAgICAgICAge3RoaXMucHJvcHMuc2VwYXJhdG9yICYmIChcbiAgICAgICAgICAgIDxTZXBhcmF0b3IgcHJvcHM9e3RoaXMucHJvcHN9IHN0YXRlPXt0aGlzLnN0YXRlfSBtZXRob2RzPXt0aGlzLm1ldGhvZHN9IC8+XG4gICAgICAgICAgKX1cblxuICAgICAgICAgIHt0aGlzLnByb3BzLmRyb3Bkb3duSGFuZGxlICYmIChcbiAgICAgICAgICAgIDxEcm9wZG93bkhhbmRsZVxuICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnNlbGVjdC5jdXJyZW50LmZvY3VzKCl9XG4gICAgICAgICAgICAgIHByb3BzPXt0aGlzLnByb3BzfVxuICAgICAgICAgICAgICBzdGF0ZT17dGhpcy5zdGF0ZX1cbiAgICAgICAgICAgICAgbWV0aG9kcz17dGhpcy5tZXRob2RzfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApfVxuXG4gICAgICAgICAge3RoaXMuc3RhdGUuZHJvcGRvd24gJiYgdGhpcy5yZW5kZXJEcm9wZG93bigpfVxuICAgICAgICA8L1JlYWN0RHJvcGRvd25TZWxlY3Q+XG4gICAgICA8L0NsaWNrT3V0c2lkZT5cbiAgICApO1xuICB9XG59XG5cblNlbGVjdC5kZWZhdWx0UHJvcHMgPSB7XG4gIGFkZFBsYWNlaG9sZGVyOiAnJyxcbiAgcGxhY2Vob2xkZXI6ICdTZWxlY3QuLi4nLFxuICB2YWx1ZXM6IFtdLFxuICBvcHRpb25zOiBbXSxcbiAgbXVsdGk6IGZhbHNlLFxuICBkaXNhYmxlZDogZmFsc2UsXG4gIHNlYXJjaEJ5OiAnbGFiZWwnLFxuICBzb3J0Qnk6IG51bGwsXG4gIGNsZWFyYWJsZTogZmFsc2UsXG4gIHNlYXJjaGFibGU6IHRydWUsXG4gIGRyb3Bkb3duSGFuZGxlOiB0cnVlLFxuICBzZXBhcmF0b3I6IGZhbHNlLFxuICBrZWVwT3BlbjogdW5kZWZpbmVkLFxuICBub0RhdGFMYWJlbDogJ05vIGRhdGEnLFxuICBjcmVhdGVOZXdMYWJlbDogJ2FkZCB7c2VhcmNofScsXG4gIGRpc2FibGVkTGFiZWw6ICdkaXNhYmxlZCcsXG4gIGRyb3Bkb3duR2FwOiA1LFxuICBjbG9zZU9uU2Nyb2xsOiBmYWxzZSxcbiAgZGVib3VuY2VEZWxheTogMCxcbiAgbGFiZWxGaWVsZDogJ2xhYmVsJyxcbiAgdmFsdWVGaWVsZDogJ3ZhbHVlJyxcbiAgY29sb3I6ICcjMDA3NEQ5JyxcbiAga2VlcFNlbGVjdGVkSW5MaXN0OiB0cnVlLFxuICBjbG9zZU9uU2VsZWN0OiBmYWxzZSxcbiAgY2xlYXJPbkJsdXI6IHRydWUsXG4gIGNsZWFyT25TZWxlY3Q6IHRydWUsXG4gIGRyb3Bkb3duUG9zaXRpb246ICdib3R0b20nLFxuICBkcm9wZG93bkhlaWdodDogJzMwMHB4JyxcbiAgYXV0b0ZvY3VzOiBmYWxzZSxcbiAgcG9ydGFsOiBudWxsLFxuICBjcmVhdGU6IGZhbHNlLFxuICBkaXJlY3Rpb246ICdsdHInLFxuICBuYW1lOiBudWxsLFxuICByZXF1aXJlZDogZmFsc2UsXG4gIHBhdHRlcm46IGZhbHNlLFxuICBvbkNoYW5nZTogKCkgPT4gdW5kZWZpbmVkLFxuICBvbkRyb3Bkb3duT3BlbjogKCkgPT4gdW5kZWZpbmVkLFxuICBvbkRyb3Bkb3duQ2xvc2U6ICgpID0+IHVuZGVmaW5lZCxcbiAgb25DbGVhckFsbDogKCkgPT4gdW5kZWZpbmVkLFxuICBvblNlbGVjdEFsbDogKCkgPT4gdW5kZWZpbmVkLFxuICBvbkNyZWF0ZU5ldzogKCkgPT4gdW5kZWZpbmVkLFxuICBzZWFyY2hGbjogKCkgPT4gdW5kZWZpbmVkLFxuICBoYW5kbGVLZXlEb3duRm46ICgpID0+IHVuZGVmaW5lZCxcbiAgYWRkaXRpb25hbFByb3BzOiBudWxsXG59O1xuXG5jb25zdCBSZWFjdERyb3Bkb3duU2VsZWN0ID0gc3R5bGVkLmRpdmBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBib3JkZXI6IDFweCBzb2xpZCAjY2NjO1xuICB3aWR0aDogMTAwJTtcbiAgYm9yZGVyLXJhZGl1czogMnB4O1xuICBwYWRkaW5nOiAycHggNXB4O1xuICBmbGV4LWRpcmVjdGlvbjogcm93O1xuICBkaXJlY3Rpb246ICR7KHsgZGlyZWN0aW9uIH0pID0+IGRpcmVjdGlvbn07XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgbWluLWhlaWdodDogMzZweDtcbiAgJHsoeyBkaXNhYmxlZCB9KSA9PlxuICAgIGRpc2FibGVkID8gJ2N1cnNvcjogbm90LWFsbG93ZWQ7cG9pbnRlci1ldmVudHM6IG5vbmU7b3BhY2l0eTogMC4zOycgOiAncG9pbnRlci1ldmVudHM6IGFsbDsnfVxuXG4gIDpob3ZlcixcbiAgOmZvY3VzLXdpdGhpbiB7XG4gICAgYm9yZGVyLWNvbG9yOiAkeyh7IGNvbG9yIH0pID0+IGNvbG9yfTtcbiAgfVxuXG4gIDpmb2N1cyxcbiAgOmZvY3VzLXdpdGhpbiB7XG4gICAgb3V0bGluZTogMDtcbiAgICBib3gtc2hhZG93OiAwIDAgMCAzcHggJHsoeyBjb2xvciB9KSA9PiBoZXhUb1JHQkEoY29sb3IsIDAuMil9O1xuICB9XG5gO1xuXG5leHBvcnQgZGVmYXVsdCBTZWxlY3Q7XG4iXX0= */")),_default=Select;exports.default=_default;